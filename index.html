

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow | จัดการงานและการเงิน</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --secondary: #10B981;
            --secondary-dark: #059669;
            --danger: #EF4444;
            --danger-dark: #DC2626;
            --warning: #F59E0B;
            --warning-dark: #D97706;
            --text-light: #1F2937;
            --text-dark: #F9FAFB;
            --bg-light: #F9FAFB;
            --bg-dark: #111827;
            --card-light: #FFFFFF;
            --card-dark: #1F2937;
            --border-light: #E5E7EB;
            --border-dark: #374151;
        }

        body {
            font-family: 'Prompt', 'Nunito', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        body.light {
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        .card {
            transition: background-color 0.3s, border-color 0.3s, transform 0.3s;
            border-width: 1px;
        }

        body.light .card {
            background-color: var(--card-light);
            border-color: var(--border-light);
        }

        body.dark .card {
            background-color: var(--card-dark);
            border-color: var(--border-dark);
        }

        .btn {
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .task-item, .finance-item {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .task-item:hover, .finance-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .tab {
            transition: all 0.3s;
            position: relative;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
            animation: tabIndicator 0.3s ease-in-out;
        }

        @keyframes tabIndicator {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: var(--primary);
        }

        .toggle-checkbox:checked + .toggle-label {
            background-color: var(--primary);
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .priority-high {
            border-left: 4px solid var(--danger);
        }

        .priority-medium {
            border-left: 4px solid var(--warning);
        }

        .priority-low {
            border-left: 4px solid var(--secondary);
        }

        .income {
            border-left: 4px solid var(--secondary);
        }

        .expense {
            border-left: 4px solid var(--danger);
        }

        .dropdown {
            transition: all 0.3s;
            transform-origin: top;
        }

        .dropdown.hidden {
            transform: scaleY(0);
            opacity: 0;
        }

        .dropdown.block {
            transform: scaleY(1);
            opacity: 1;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 20px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(156, 163, 175, 0.8);
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .task-actions, .finance-actions {
                flex-direction: column;
            }
            
            .task-actions button, .finance-actions button {
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body class="light min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <svg class="w-10 h-10 text-indigo-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                </svg>
                <h1 class="text-3xl font-bold ml-2 data-lang" data-th="TaskFlow" data-en="TaskFlow">TaskFlow</h1>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Language Toggle -->
                <div class="flex items-center">
                    <button id="langToggle" class="px-3 py-1 rounded-md bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-200 font-medium">
                        <span class="data-lang" data-th="EN" data-en="TH">EN</span>
                    </button>
                </div>
                
                <!-- Dark Mode Toggle -->
                <div class="flex items-center">
                    <div class="relative inline-block w-12 align-middle select-none">
                        <input type="checkbox" name="toggle" id="themeToggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer focus:outline-none transition-all duration-300 ease-in-out" style="right: 0;">
                        <label for="themeToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer transition-all duration-300 ease-in-out"></label>
                    </div>
                    <span class="ml-2">
                        <i id="themeIcon" class="fas fa-moon"></i>
                    </span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="flex border-b border-gray-200 dark:border-gray-700 mb-6">
            <button id="tasksTab" class="tab active px-4 py-2 font-medium text-lg focus:outline-none data-lang" data-th="งาน" data-en="Tasks">งาน</button>
            <button id="financeTab" class="tab px-4 py-2 font-medium text-lg focus:outline-none data-lang" data-th="การเงิน" data-en="Finance">การเงิน</button>
        </div>

        <!-- Tasks Section -->
        <div id="tasksSection" class="animate-fade-in">
            <!-- Add Task Form -->
            <div class="card rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 data-lang" data-th="เพิ่มงานใหม่" data-en="Add New Task">เพิ่มงานใหม่</h2>
                <form id="taskForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="taskTitle" class="block mb-1 font-medium data-lang" data-th="ชื่องาน" data-en="Task Title">ชื่องาน</label>
                            <input type="text" id="taskTitle" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div>
                            <label for="taskDueDate" class="block mb-1 font-medium data-lang" data-th="กำหนดส่ง" data-en="Due Date">กำหนดส่ง</label>
                            <input type="date" id="taskDueDate" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="taskDescription" class="block mb-1 font-medium data-lang" data-th="รายละเอียด" data-en="Description">รายละเอียด</label>
                        <textarea id="taskDescription" rows="2" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="taskPriority" class="block mb-1 font-medium data-lang" data-th="ความสำคัญ" data-en="Priority">ความสำคัญ</label>
                            <select id="taskPriority" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="low" class="data-lang" data-th="ต่ำ" data-en="Low">ต่ำ</option>
                                <option value="medium" class="data-lang" data-th="ปานกลาง" data-en="Medium">ปานกลาง</option>
                                <option value="high" class="data-lang" data-th="สูง" data-en="High">สูง</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button type="submit" class="btn px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 data-lang" data-th="เพิ่มงาน" data-en="Add Task">เพิ่มงาน</button>
                        </div>
                    </div>
                    <input type="hidden" id="taskId" value="">
                </form>
            </div>

            <!-- Task List -->
            <div class="card rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold data-lang" data-th="รายการงาน" data-en="Task List">รายการงาน</h2>
                    <div class="flex space-x-2">
                        <select id="taskFilter" class="px-3 py-1 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="all" class="data-lang" data-th="ทั้งหมด" data-en="All">ทั้งหมด</option>
                            <option value="completed" class="data-lang" data-th="เสร็จแล้ว" data-en="Completed">เสร็จแล้ว</option>
                            <option value="pending" class="data-lang" data-th="รอดำเนินการ" data-en="Pending">รอดำเนินการ</option>
                        </select>
                        <button id="clearCompletedTasks" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-sm focus:outline-none data-lang" data-th="ลบงานที่เสร็จแล้ว" data-en="Clear Completed">ลบงานที่เสร็จแล้ว</button>
                    </div>
                </div>
                
                <div id="taskList" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                    <!-- Tasks will be added here dynamically -->
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400 data-lang" data-th="ไม่มีงาน เพิ่มงานใหม่เลย!" data-en="No tasks yet. Add your first task!">ไม่มีงาน เพิ่มงานใหม่เลย!</div>
                </div>
            </div>
        </div>

        <!-- Finance Section -->
        <div id="financeSection" class="hidden animate-fade-in">
            <!-- Finance Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="card rounded-lg shadow-md p-6 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800">
                    <h3 class="text-lg font-medium text-green-800 dark:text-green-200 mb-2 data-lang" data-th="รายรับทั้งหมด" data-en="Total Income">รายรับทั้งหมด</h3>
                    <p id="totalIncome" class="text-2xl font-bold text-green-600 dark:text-green-300">฿0.00</p>
                </div>
                <div class="card rounded-lg shadow-md p-6 bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900 dark:to-red-800">
                    <h3 class="text-lg font-medium text-red-800 dark:text-red-200 mb-2 data-lang" data-th="รายจ่ายทั้งหมด" data-en="Total Expenses">รายจ่ายทั้งหมด</h3>
                    <p id="totalExpenses" class="text-2xl font-bold text-red-600 dark:text-red-300">฿0.00</p>
                </div>
                <div class="card rounded-lg shadow-md p-6 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800">
                    <h3 class="text-lg font-medium text-blue-800 dark:text-blue-200 mb-2 data-lang" data-th="ยอดคงเหลือ" data-en="Balance">ยอดคงเหลือ</h3>
                    <p id="balance" class="text-2xl font-bold text-blue-600 dark:text-blue-300">฿0.00</p>
                </div>
            </div>

            <!-- Add Finance Form -->
            <div class="card rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 data-lang" data-th="เพิ่มรายการการเงิน" data-en="Add Financial Transaction">เพิ่มรายการการเงิน</h2>
                <form id="financeForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="financeTitle" class="block mb-1 font-medium data-lang" data-th="รายการ" data-en="Title">รายการ</label>
                            <input type="text" id="financeTitle" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div>
                            <label for="financeAmount" class="block mb-1 font-medium data-lang" data-th="จำนวนเงิน" data-en="Amount">จำนวนเงิน</label>
                            <input type="number" id="financeAmount" min="0" step="0.01" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="financeType" class="block mb-1 font-medium data-lang" data-th="ประเภท" data-en="Type">ประเภท</label>
                            <select id="financeType" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="income" class="data-lang" data-th="รายรับ" data-en="Income">รายรับ</option>
                                <option value="expense" class="data-lang" data-th="รายจ่าย" data-en="Expense">รายจ่าย</option>
                            </select>
                        </div>
                        <div>
                            <label for="financeDate" class="block mb-1 font-medium data-lang" data-th="วันที่" data-en="Date">วันที่</label>
                            <input type="date" id="financeDate" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="financeCategory" class="block mb-1 font-medium data-lang" data-th="หมวดหมู่" data-en="Category">หมวดหมู่</label>
                        <input type="text" id="financeCategory" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="flex justify-end">
                        <button type="submit" class="btn px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 data-lang" data-th="บันทึก" data-en="Save">บันทึก</button>
                    </div>
                    <input type="hidden" id="financeId" value="">
                </form>
            </div>

            <!-- Finance List -->
            <div class="card rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold data-lang" data-th="รายการการเงิน" data-en="Financial Transactions">รายการการเงิน</h2>
                    <div class="flex space-x-2">
                        <select id="financeFilter" class="px-3 py-1 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="all" class="data-lang" data-th="ทั้งหมด" data-en="All">ทั้งหมด</option>
                            <option value="income" class="data-lang" data-th="รายรับ" data-en="Income">รายรับ</option>
                            <option value="expense" class="data-lang" data-th="รายจ่าย" data-en="Expense">รายจ่าย</option>
                        </select>
                        <button id="clearAllFinances" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-md text-sm focus:outline-none data-lang" data-th="ล้างข้อมูล" data-en="Clear All">ล้างข้อมูล</button>
                    </div>
                </div>
                
                <div id="financeList" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                    <!-- Finance items will be added here dynamically -->
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400 data-lang" data-th="ไม่มีรายการการเงิน เพิ่มรายการแรกของคุณ!" data-en="No financial transactions yet. Add your first one!">ไม่มีรายการการเงิน เพิ่มรายการแรกของคุณ!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 py-6 border-t border-gray-200 dark:border-gray-800">
        <div class="container mx-auto px-4 text-center text-gray-600 dark:text-gray-400">
            <p class="data-lang" data-th="© 2023 TaskFlow - จัดการงานและการเงินของคุณอย่างมีประสิทธิภาพ" data-en="© 2023 TaskFlow - Manage your tasks and finances efficiently">© 2023 TaskFlow - จัดการงานและการเงินของคุณอย่างมีประสิทธิภาพ</p>
        </div>
    </footer>

    <script>
        // Initialize data
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let finances = JSON.parse(localStorage.getItem('finances')) || [];
        let currentLanguage = localStorage.getItem('language') || 'th';
        let currentTheme = localStorage.getItem('theme') || 'light';
        let editingTaskId = null;
        let editingFinanceId = null;

        // DOM Elements
        const taskForm = document.getElementById('taskForm');
        const taskList = document.getElementById('taskList');
        const financeForm = document.getElementById('financeForm');
        const financeList = document.getElementById('financeList');
        const tasksTab = document.getElementById('tasksTab');
        const financeTab = document.getElementById('financeTab');
        const tasksSection = document.getElementById('tasksSection');
        const financeSection = document.getElementById('financeSection');
        const langToggle = document.getElementById('langToggle');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const taskFilter = document.getElementById('taskFilter');
        const financeFilter = document.getElementById('financeFilter');
        const clearCompletedTasks = document.getElementById('clearCompletedTasks');
        const clearAllFinances = document.getElementById('clearAllFinances');
        const totalIncome = document.getElementById('totalIncome');
        const totalExpenses = document.getElementById('totalExpenses');
        const balance = document.getElementById('balance');

        // Initialize the app
        function init() {
            // Set theme
            setTheme(currentTheme);
            
            // Set language
            setLanguage(currentLanguage);
            
            // Render tasks and finances
            renderTasks();
            renderFinances();
            updateFinanceSummary();
        }

        // Theme functions
        function setTheme(theme) {
            document.body.className = theme;
            themeToggle.checked = theme === 'dark';
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', theme);
            currentTheme = theme;
        }

        // Language functions
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            // Update all elements with data-lang attribute
            document.querySelectorAll('.data-lang').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });
            
            // Update placeholder texts
            updatePlaceholders();
        }

        function updatePlaceholders() {
            // You can add placeholder updates here if needed
        }

        // Task functions
        function addTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;
            const id = document.getElementById('taskId').value;
            
            if (!title) return;
            
            if (id) {
                // Edit existing task
                const index = tasks.findIndex(task => task.id === id);
                if (index !== -1) {
                    tasks[index] = {
                        ...tasks[index],
                        title,
                        description,
                        dueDate,
                        priority,
                        updatedAt: new Date().toISOString()
                    };
                }
                document.getElementById('taskId').value = '';
                editingTaskId = null;
            } else {
                // Add new task
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    description,
                    dueDate,
                    priority,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                tasks.push(newTask);
            }
            
            // Save to localStorage and render
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            
            // Reset form
            taskForm.reset();
        }

        function deleteTask(id) {
            tasks = tasks.filter(task => task.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function toggleTaskCompletion(id) {
            const task = tasks.find(task => task.id === id);
            if (task) {
                task.completed = !task.completed;
                task.updatedAt = new Date().toISOString();
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
            }
        }

        function editTask(id) {
            const task = tasks.find(task => task.id === id);
            if (task) {
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskDueDate').value = task.dueDate || '';
                document.getElementById('taskPriority').value = task.priority || 'low';
                document.getElementById('taskId').value = task.id;
                editingTaskId = task.id;
                
                // Scroll to form
                taskForm.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function clearCompletedTasksHandler() {
            tasks = tasks.filter(task => !task.completed);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function renderTasks() {
            // Filter tasks based on selected filter
            const filterValue = taskFilter.value;
            let filteredTasks = [...tasks];
            
            if (filterValue === 'completed') {
                filteredTasks = filteredTasks.filter(task => task.completed);
            } else if (filterValue === 'pending') {
                filteredTasks = filteredTasks.filter(task => !task.completed);
            }
            
            // Sort tasks by creation date (newest first)
            filteredTasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `<div class="text-center py-8 text-gray-500 dark:text-gray-400 data-lang" data-th="ไม่มีงาน" data-en="No tasks found">${currentLanguage === 'th' ? 'ไม่มีงาน' : 'No tasks found'}</div>`;
                return;
            }
            
            taskList.innerHTML = '';
            
            filteredTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item card rounded-lg p-4 ${task.priority}-priority ${task.completed ? 'opacity-70' : ''}`;
                
                const formattedDate = task.dueDate ? new Date(task.dueDate).toLocaleDateString() : '';
                const priorityLabel = {
                    'low': currentLanguage === 'th' ? 'ต่ำ' : 'Low',
                    'medium': currentLanguage === 'th' ? 'ปานกลาง' : 'Medium',
                    'high': currentLanguage === 'th' ? 'สูง' : 'High'
                };
                
                taskElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 pt-1">
                            <input type="checkbox" class="w-5 h-5 rounded-md border-gray-300 text-indigo-600 focus:ring-indigo-500" ${task.completed ? 'checked' : ''} onchange="toggleTaskCompletion('${task.id}')">
                        </div>
                        <div class="ml-3 flex-grow">
                            <h3 class="text-lg font-medium ${task.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}">${task.title}</h3>
                            ${task.description ? `<p class="text-gray-600 dark:text-gray-300 mt-1 ${task.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''}">${task.description}</p>` : ''}
                            <div class="flex flex-wrap gap-2 mt-2">
                                ${formattedDate ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${formattedDate}
                                </span>` : ''}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                    ${task.priority === 'high' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 
                                    task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' : 
                                    'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'}">
                                    ${priorityLabel[task.priority]}
                                </span>
                            </div>
                        </div>
                        <div class="flex-shrink-0 ml-2 task-actions">
                            <button onclick="editTask('${task.id}')" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 mr-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteTask('${task.id}')" class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
            });
            
            // Update language for newly added elements
            setLanguage(currentLanguage);
        }

        // Finance functions
        function addFinance(e) {
            e.preventDefault();
            
            const title = document.getElementById('financeTitle').value.trim();
            const amount = parseFloat(document.getElementById('financeAmount').value);
            const type = document.getElementById('financeType').value;
            const date = document.getElementById('financeDate').value || new Date().toISOString().split('T')[0];
            const category = document.getElementById('financeCategory').value.trim();
            const id = document.getElementById('financeId').value;
            
            if (!title || isNaN(amount) || amount <= 0) return;
            
            if (id) {
                // Edit existing finance
                const index = finances.findIndex(finance => finance.id === id);
                if (index !== -1) {
                    finances[index] = {
                        ...finances[index],
                        title,
                        amount,
                        type,
                        date,
                        category,
                        updatedAt: new Date().toISOString()
                    };
                }
                document.getElementById('financeId').value = '';
                editingFinanceId = null;
            } else {
                // Add new finance
                const newFinance = {
                    id: Date.now().toString(),
                    title,
                    amount,
                    type,
                    date,
                    category,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                finances.push(newFinance);
            }
            
            // Save to localStorage and render
            localStorage.setItem('finances', JSON.stringify(finances));
            renderFinances();
            updateFinanceSummary();
            
            // Reset form
            financeForm.reset();
            document.getElementById('financeDate').value = new Date().toISOString().split('T')[0];
        }

        function deleteFinance(id) {
            finances = finances.filter(finance => finance.id !== id);
            localStorage.setItem('finances', JSON.stringify(finances));
            renderFinances();
            updateFinanceSummary();
        }

        function editFinance(id) {
            const finance = finances.find(finance => finance.id === id);
            if (finance) {
                document.getElementById('financeTitle').value = finance.title;
                document.getElementById('financeAmount').value = finance.amount;
                document.getElementById('financeType').value = finance.type;
                document.getElementById('financeDate').value = finance.date;
                document.getElementById('financeCategory').value = finance.category || '';
                document.getElementById('financeId').value = finance.id;
                editingFinanceId = finance.id;
                
                // Scroll to form
                financeForm.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function clearAllFinancesHandler() {
            if (confirm(currentLanguage === 'th' ? 'คุณแน่ใจหรือไม่ที่จะลบรายการการเงินทั้งหมด?' : 'Are you sure you want to delete all financial transactions?')) {
                finances = [];
                localStorage.setItem('finances', JSON.stringify(finances));
                renderFinances();
                updateFinanceSummary();
            }
        }

        function renderFinances() {
            // Filter finances based on selected filter
            const filterValue = financeFilter.value;
            let filteredFinances = [...finances];
            
            if (filterValue === 'income') {
                filteredFinances = filteredFinances.filter(finance => finance.type === 'income');
            } else if (filterValue === 'expense') {
                filteredFinances = filteredFinances.filter(finance => finance.type === 'expense');
            }
            
            // Sort finances by date (newest first)
            filteredFinances.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredFinances.length === 0) {
                financeList.innerHTML = `<div class="text-center py-8 text-gray-500 dark:text-gray-400 data-lang" data-th="ไม่มีรายการการเงิน" data-en="No financial transactions found">${currentLanguage === 'th' ? 'ไม่มีรายการการเงิน' : 'No financial transactions found'}</div>`;
                return;
            }
            
            financeList.innerHTML = '';
            
            filteredFinances.forEach(finance => {
                const financeElement = document.createElement('div');
                financeElement.className = `finance-item card rounded-lg p-4 ${finance.type}`;
                
                const formattedDate = finance.date ? new Date(finance.date).toLocaleDateString() : '';
                const formattedAmount = new Intl.NumberFormat(currentLanguage === 'th' ? 'th-TH' : 'en-US', {
                    style: 'currency',
                    currency: 'THB',
                    minimumFractionDigits: 2
                }).format(finance.amount);
                
                financeElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 pt-1">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center ${finance.type === 'income' ? 'bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-300' : 'bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300'}">
                                <i class="fas ${finance.type === 'income' ? 'fa-arrow-down' : 'fa-arrow-up'}"></i>
                            </div>
                        </div>
                        <div class="ml-3 flex-grow">
                            <h3 class="text-lg font-medium">${finance.title}</h3>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${formattedDate}
                                </span>
                                ${finance.category ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${finance.category}
                                </span>` : ''}
                            </div>
                        </div>
                        <div class="flex flex-col items-end ml-2">
                            <span class="text-lg font-semibold ${finance.type === 'income' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">
                                ${finance.type === 'income' ? '+' : '-'} ${formattedAmount}
                            </span>
                            <div class="flex mt-2 finance-actions">
                                <button onclick="editFinance('${finance.id}')" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 mr-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button onclick="deleteFinance('${finance.id}')" class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                financeList.appendChild(financeElement);
            });
            
            // Update language for newly added elements
            setLanguage(currentLanguage);
        }

        function updateFinanceSummary() {
            let incomeTotal = 0;
            let expenseTotal = 0;
            
            finances.forEach(finance => {
                if (finance.type === 'income') {
                    incomeTotal += finance.amount;
                } else {
                    expenseTotal += finance.amount;
                }
            });
            
            const balanceTotal = incomeTotal - expenseTotal;
            
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat(currentLanguage === 'th' ? 'th-TH' : 'en-US', {
                    style: 'currency',
                    currency: 'THB',
                    minimumFractionDigits: 2
                }).format(amount);
            };
            
            totalIncome.textContent = formatCurrency(incomeTotal);
            totalExpenses.textContent = formatCurrency(expenseTotal);
            balance.textContent = formatCurrency(balanceTotal);
            
            // Add color to balance based on value
            if (balanceTotal > 0) {
                balance.className = 'text-2xl font-bold text-green-600 dark:text-green-300';
            } else if (balanceTotal < 0) {
                balance.className = 'text-2xl font-bold text-red-600 dark:text-red-300';
            } else {
                balance.className = 'text-2xl font-bold text-blue-600 dark:text-blue-300';
            }
        }

        // Event Listeners
        taskForm.addEventListener('submit', addTask);
        financeForm.addEventListener('submit', addFinance);
        
        tasksTab.addEventListener('click', () => {
            tasksTab.classList.add('active');
            financeTab.classList.remove('active');
            tasksSection.classList.remove('hidden');
            financeSection.classList.add('hidden');
        });
        
        financeTab.addEventListener('click', () => {
            financeTab.classList.add('active');
            tasksTab.classList.remove('active');
            financeSection.classList.remove('hidden');
            tasksSection.classList.add('hidden');
        });
        
        langToggle.addEventListener('click', () => {
            const newLang = currentLanguage === 'th' ? 'en' : 'th';
            setLanguage(newLang);
        });
        
        themeToggle.addEventListener('change', () => {
            const newTheme = themeToggle.checked ? 'dark' : 'light';
            setTheme(newTheme);
        });
        
        taskFilter.addEventListener('change', renderTasks);
        financeFilter.addEventListener('change', renderFinances);
        
        clearCompletedTasks.addEventListener('click', clearCompletedTasksHandler);
        clearAllFinances.addEventListener('click', clearAllFinancesHandler);
        
        // Set today's date as default for date inputs
        document.getElementById('financeDate').valueAsDate = new Date();
        
        // Initialize the app
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'953885bde2607328',t:'MTc1MDU2MTUxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
